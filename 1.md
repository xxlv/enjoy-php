
# 择木而栖

#### 环境
PHP的开发需要一个环境，下载源码编译并配置是可行的，但对于我们这些小白来讲未免有些麻烦，wamp/lamp套件可以很轻松的搭建一个像模像样的环境出来，其中wamp是windows平台下使用的,lamp是linux下的。这是一个套件,其包含了apache,mysql,php。


**wamp的传送门是：http://www.wampserver.com/en/**

PHP是一门解释性的语言，这意味着它需要一个解释器来解释运行它，PHP提供了许多的SAPI来让PHP满足各种应用场景的需求，为了PHP与Aapache进行通信，PHP有单独的SAPI与之对应.此外还有与命令行通信的cli sapi等。


#### HTTP请求与响应
一次HTTP请求的过程是这样的：当在浏览器输入http://www.example.com,
按下回车键的时候，浏览器接收到此次请求，分析请求头，依次查询dns,分析www.example.com所对应的ip地址,首先是hosts文件(本地dns文件，这个在配置虚拟主机的时候非常有用)，找到ip后，将HTTP请求数据推送给www.example.com主机的80端口（默认是80,可以修改）。

在www.example.com所在的主机有一个web服务器（例如apache）,它静静的在80端口上侦听，一旦发现来自浏览器的http请求，马上开始解析请求，这个过程可能很复杂，最后将解析的结果返回给浏览器。

因为apache自己本身无法解析PHP文件，它通过apache2handle这个sapi将数据交给php来解析，最后由apache统一构造http响应头，返回给浏览器。
这里面有两个很重要的概念：
- HTTP请求头
- HTTP响应头

这部分的知识在RFC2616<http://www.ietf.org/rfc/rfc2616.txt>中有详细的描述。

#### 浏览器的渲染

浏览器接受到来自服务器的响应，从响应正文中获得body，并将其渲染在页面上。body一般是HTML结构的字符串，可以有浏览器进行渲染，甚至更智能的浏览器会自动更正待渲染的html结构。
浏览器使用一个dom树来依次加载元素，使用css进行样式控制。javascript负责动态的交互效果，包含动态修改dom结构，异步发送请求，ajax等。至此，页面就展现在用户面前了。 

值得注意的一点是，一次HTTP的请求时无状态的，当下一次请求来的时候，服务器不知道这是不是来自上一次请求的同一人。

这样的一个弊端是，当A用户登录后，请求新的页面，A用户仍旧需要再次登陆。

#### COOKIE与SESSION

这是频繁的要求用户登录显然是不可行的，这很容易人抓狂。为了解决这个问题，聪明的人们想出了一个办法。（试着想个办法）。

- 方案A Cookie

Cookie是什么？Cookie是一个存放了key/value的普通文件，为了维持用户的状态，我们想到的办法是将标识用户状态的关键信息记录下来。关于cookie的详细介绍可参看<https://en.wikipedia.org/wiki/HTTP_cookie>
Cookie记录了一些数据，当访问服务器的时候，浏览器将携带此Cookie到服务器，服务器将读取Cookie的内容，并获得之前的“状态描述”。Cookie有内存维护和硬盘维护，内存维护的Cookie在浏览器关闭之后会丢失。Cookie也有一些缺点，比如安全性，对性能的影响以及大小的限制。

- 方案B Session

注意到Cookie是保存在客户端中，这无形中增加了被篡改的可能性，另一种方法是使用Session将“状态描述”保存在服务器端，需要注意的是，浏览器发起请求服务器的时候，需要携带一个session_id来获得该session的内容，这个session_id一般保存在Cookie中，这也是比较迷惑的地方，但是完全可以不用Cookie来传递session_id，一个场景是当浏览器禁用Cookie的时候，不得不将session_id暴露在URL参数中（GET方式），以便于让服务器获得。


#### PHP的角色

PHP处于什么样的位置呢？它跟JS(Javascript)有河区别？
JS和PHP都是一种编程语言。

PHP一般作为服务器端（Server）的语言存在,而JS作为客户端（这里是浏览器）端的语言，相互协同，共同组成了形形色色的B/S系统。JS负责前端交互，JS天生就拥有操作DOM的能力，可以构建出现在网站的动态效果。配合CSS来实现动画等一系列复杂的渲染动作，而PHP则负责处理所有的数据请求，并返回相应的结果。

这不是绝对的，JS也可以在服务器端监听80端口并处理来自Client的请求(Node.js)。

例如一个网站提供注册功能的实现是这样的：HTML构建基本表单，Form将Action指向服务器地址，Js负责触发Submit请求，并在Submit到服务器之前做表单的输入检查，服务器端接收POST请求，获得用户输入数据，插入数据库，返回结果并呈现给用户反馈页。





